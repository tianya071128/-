## 何为模块? 

JS "共享一切" 的代码加载方式是该语言混乱且最易出错的方面之一.

**模块(modules)是使用不同方式加载的 JS 文件(与JS原先的脚本加载方式相对); **

**模块与脚本(script)有大大不同的语义:**

1. 模块代码自动运行在严格模式下, 并且没有任何办法跳出严格模式;
2. 在模块的顶级作用域创建的变量, 不会被自动添加到共享的全局作用域, 它们只会在模块顶级作用域的内部存在;
3. 模块顶级作用域的 `this` 值为 `undefined`;
4. 模块不允许在代码中使用 `HTML` 风格的注释(这是 JS 来自于早起浏览器的历史遗留特性);
5. 对于需要让模块外部代码访问的内容, 模块必须导出它们;
6. 运行模块从其他模块导入绑定;

**模块的真实力量是按需导出与导入代码的能力, 而不用将所有内容放在同一个文件内. 对于导出与导入的清楚理解, 是辨别模块与脚本差异的基础**



## 基本的导出

使用 `export` 关键字

```javascript
// 导出数据
export var color = 'red';
// 导出函数
export function sum() {};

// 模块私有 函数
function subtract() {};

// 定义一个函数...
function multiply() {};
// ...稍后将其导出
export { multiply };
```

**注意点: **

1. 每个被导出的函数或类都有名称, 这是因为导出的函数声明与类声明必须要有名称.
2. 不能使用这种语法来导出匿名函数或匿名类, 除非使用了 `default` 关键字(在"模块的默认值"一节会论述).
3. 不仅能导出声明, 还可以导出引用. (例如最后一个例子)
4. 没有被显式导出的变量、函数或类都会在模块内保持私有.



## 基本的导入

**注意点: **

1. 不允许对已导入的绑定重新赋值, 否则会导致错误(**类似 `const`, 可以对对象属性重新赋值)**
2. 允许将整个模块当做单一对象进行导入, 该模块的所有导出都会作为对象的属性存在
3. **无论对同一个模块使用了多少次 `import` 语句, 该模块都只会被执行一次. 已被实例化的模块就被保留在内存中, 并随时都能被其他 `import` 所引用**
4. `export` 与 `import` 都有一个重要的限制, 那就是它们必须被用在其他语句或表达式的外部. **只能在模块的顶级作用域使用 `export` 和 `import`**

```javascript
// 单个导入
import { sum } from './example.js'; 

// 导入多个绑定
import { sum, multiply, magicNumber } from './example.js';

// 完全导入
import * as example from './example.js';

// 模块语法的限制（Module Syntax Limitations）
if (flag) {
    export flag; // 语法错误
}
function tryImport() {
    import flag from "./example.js"; // 语法错误
}
```



## 重命名导出与导入

可以更改导出的名称, 无论在导出过程中, 还是导入过程中, 都可以

```javascript
// 重命名导出
function sum() {};

// 此处的 sum() 函数被作为 add() 导出, 前者是本地名称, 后者则是导出名称. 也就是说, 当另一个模块要导入此函数时, 它必须改用 add 这个名称
export { sum as add };
import { add } from './example.js';

// ===========================
// 重命名导入
import { add as sum } from './example.js';
```



## 模块的默认值

1. 模块的默认值是使用 `default` 关键字所指定的单个变量、函数或类, **在每个模块中只能设置一个默认导出, 将 `default` 关键字用于多个导出会是语法错误.**

```javascript
// 1. 导出默认值
export default function() {};

// 2. 在 export default 后面放置一个标识符, 以指定默认的导出
function sum() {};
export default sum;

// 3. 使用重命名语法
function sum() {};
export { sum as default };

// =========================
// 导入默认值 -- 不需要使用花括号
import sum from './example.js';

// 同时导入其他值和默认值
import sum, { color } from './example.js';

// 重命名导入默认值
import { default as sum, color } from './example.js'; 
```





















